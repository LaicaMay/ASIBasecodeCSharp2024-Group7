@using System.Security.Claims
@model ExpenseTracker.Data.Models.CustomModels.OverviewViewModel;
@{
    Layout = "_MainLayout";
}
<link href="~/mainstyle/expense-details.css" rel="stylesheet" />
<link href="~/mainstyle/add-expense.css" rel="stylesheet" />
        <div class="main-container">
            @if (User.Identity.IsAuthenticated)
            {
                <div class="main-title">
                    <h2>Hey there, @User.FindFirst(ClaimTypes.NameIdentifier)?.Value!</h2>
                    <p>Your budgets</p>
                </div>
            }      
            <div class="balance-container">             
                    <div class="expense">
                        <p id="expense-category">Grocery</p>
                        <p id="expense-tag">PHP1,500.00</p>
                        <p id="expense-user">Mori Estella</p>
                        <div id="deduction">-750.00</div>
                    </div>
                    <div class="expense">
                        <p id="expense-category">School</p>
                        <p id="expense-tag">PHP2,500.00</p>
                        <p id="expense-user">Mori Estella</p>
                        <div id="deduction">-100.00</div>
                    </div> 
            </div>
            <div class="bottom-title">
                Recent Expenses
            </div>
            <div id="table-content" class="hide">
                <table class="table-expense">
                    <thead>
                        <tr>                        
                            <th>
                               <div >
                                    <img src="~/images/iconVec/down-arrw.svg" alt="">
                               </div>
                            </th>
                            <th>Expense Name</th>
                            <th>Amount</th>
                            <th>Date <img src="~/images/iconVec/down-arrw.svg" alt=""></th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    @if (Model.ExpensesView != null && Model.ExpensesView.Any())
                        {
                            foreach (var item in Model.ExpensesView)
                            {
                                <tr>
                                    <td data-user-id="@item.UserId"                                      
                                        data-expense-name="@item.ExpenseName"
                                        data-amount="@item.Amount"
                                        data-category-name="@item.CategoryName"
                                        data-date="@item.Date"
                                        data-description="@item.Description"
                                    >
                                        <div style="display: flex;
                                    align-items: center;
                                    justify-content: start; padding-left: 0px;
                                            ">
                                            <div class="img-bg">
                                                <img src="~/images/iconVec/tags.svg" alt="">
                                            </div>
                                            <p style="margin-left: 10px;">@item.CategoryName</p>
                                        </div>
                                    </td>
                                    <td>@item.ExpenseName</td>
                                    <td>₱@item.Amount</td>
                                    <td>@item.Date</td>
                                    <td><a id="item-details">Details</a></td>
                                </tr>
                            }
                        } else
                        {
                            <tr>
                                <td colspan="5">No recent expenses.</td>                                        
                            </tr>
                        }
                    </tbody>
                </table>
                <div class="button-search">
                    <div style="position: relative;">
                        <input type="text" placeholder="Search">
                        <div style="position: absolute;
                        top: 10px; right: 0;">
                            <button id="searchBtn">Search</button>
                        </div>
                    </div>
                    <a id="add-id">Add Expenses</a>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <div id="view-recent" class="recent-hide">
                    <a href="#">View Recent</a>
                </div>
                <div id="add-expense" class="recent-hide">
                    <a id="m-add-id" href="#">Add Expenses</a>
                </div>
            </div>
        </div>

        <div id="expense-container" class="hide">
            <div id="expense-details">
                <div style="display: flex; align-items: center; justify-content: center;
                            margin-top: 10px;
                            margin-bottom: 10px;">
                    <div>
                        <p class="details-expense">Expense Details</p>
                    </div>
                </div>
                <div style="display: flex; flex-direction: row; align-items: center;
                            justify-content: start;
                            margin-top: 25px;">
                    <div style="display: flex; flex-direction: column;
                                margin-left: 20px;
                                gap: 15px;
                                margin-top: 5px;">
                        <div>
                            <img src="~/images/iconVec/ingredient-icon.svg" alt="">
                        </div>
                        <div>
                            <img src="~/images/iconVec/money-icon.svg" alt="">
                        </div>
                        <div>
                            <img src="~/images/iconVec/CategoryThumbail.svg" alt="">
                        </div>
                        <div>
                            <img src="~/images/iconVec/bag-icon.svg" alt="">
                        </div>
                        <div>
                            <img src="/images/iconVec/paper-icon.svg" alt="">
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; margin-left: 20px;
                                gap: 15px;">
                        <p id="modal-expense-name"></p>
                        <p id="modal-amount"></p>
                        <p id="modal-category-name"></p>
                        <p id="modal-date"></p>
                        <p id="modal-description"></p>
                    </div>
                </div>
                <div style="display: flex; align-items: center; justify-content: center;
                            margin-top: 10px;
                            margin-bottom: 10px;">
                    <button id="edit">Edit</button>
                </div>
                <div style="display: flex; align-items: center; justify-content: center;
                            margin-top: 10px;
                            margin-bottom: 10px;">
                    <button id="del">Delete</button>
                </div>
            </div>
            <div class="blur-bg">
            </div>
        </div>    
        
        @await Html.PartialAsync("_AddExpensePartialView", new Expense())

<script>
    document.getElementById('add-id').addEventListener('click', function (event) {
        event.stopPropagation();

        let expenseCont = document.getElementById('add-expense-container');

        if (expenseCont.classList.contains('hide')) {
            expenseCont.classList.remove('hide');
            expenseCont.classList.add('show');
        }
    });

    document.getElementById('add-blur').addEventListener('click', function (event) {
        event.stopPropagation();
        document.getElementById('add-expense-container').classList.remove('show');
        document.getElementById('add-expense-container').classList.add('hide');
    });

    document.getElementById('m-add-id').addEventListener('click', function (event) {
        event.stopPropagation();

        let expenseCont = document.getElementById('add-expense-container');

        if (expenseCont.classList.contains('hide')) {
            expenseCont.classList.remove('hide');
            expenseCont.classList.add('show');
        }
    });  
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('#item-details').forEach(function (detailsLink) {
            detailsLink.addEventListener('click', function () {
                const parentRow = this.closest('tr').querySelector('td');

                const expenseName = parentRow.getAttribute('data-expense-name');
                const amount = parentRow.getAttribute('data-amount');
                const categoryName = parentRow.getAttribute('data-category-name');
                const date = parentRow.getAttribute('data-date');
                const description = parentRow.getAttribute('data-description');

                document.getElementById('modal-expense-name').textContent = expenseName;
                document.getElementById('modal-amount').textContent = `₱${amount}`;
                document.getElementById('modal-category-name').textContent = categoryName;
                document.getElementById('modal-date').textContent = date;
                document.getElementById('modal-description').textContent = description;

                document.getElementById('expense-container').classList.remove('hide');
                document.getElementById('expense-container').classList.add('show');
            });
        });

        document.querySelector('.blur-bg').addEventListener('click', function () {
            document.getElementById('expense-container').classList.remove('show');
            document.getElementById('expense-container').classList.add('hide');
        });
    });
</script>